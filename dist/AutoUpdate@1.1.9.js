!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.AutoUpdate=e():t.AutoUpdate=e()}(self,(()=>(()=>{"use strict";var t={d:(e,s)=>{for(var i in s)t.o(s,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:s[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{default:()=>i});var s=function(t,e,s,i){return new(s||(s=Promise))((function(o,r){function n(t){try{h(i.next(t))}catch(t){r(t)}}function l(t){try{h(i.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?o(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(n,l)}h((i=i.apply(t,e||[])).next())}))};const i=class{constructor(t){this._lastSrcs=[],this._htmlLangth=0,this._srciptReg=/\<script.*src=["'](?<src>[^"']+)/gm,this._baseUrl="/",this._isWatchHtmlLength=!1,this._debugger=!1,this._times=2e3,this._response=void 0,t&&t.baseUrl&&(this._baseUrl=t.baseUrl),t&&t.times&&(this._times=t.times),t&&"function"==typeof t.response&&(this._response=t.response),t&&"boolean"==typeof t.isWatchHtmlLength&&(this._isWatchHtmlLength=t.isWatchHtmlLength),t&&"boolean"==typeof t.debugger&&(this._debugger=t.debugger),this.startTest()}extractNewScripts(){return s(this,void 0,void 0,(function*(){const t=yield fetch(this._baseUrl+"?_timestamp="+Date.now()).then((t=>t.text()));this._srciptReg.lastIndex=0;let e,s=[];for(;e=this._srciptReg.exec(t);)if(e&&e.groups){const t=e.groups.src;-1===s.findIndex((e=>e===t))&&s.push(t)}return{result:s,html:t}}))}needUpdate(){return s(this,void 0,void 0,(function*(){const{result:t,html:e}=yield this.extractNewScripts();let s=!1;if(this._lastSrcs&&0!==this._lastSrcs.length||(this._lastSrcs=t),this._lastSrcs.length!==t.length)return s=!0,this._debugger&&(console.log("判断 script的src数组长度不一致"),console.log(`保存的的script的src数组集合 length: ${this._lastSrcs.length} `,this._lastSrcs),console.log(`新的的script的src数组集合 length: ${t.length} `,t)),s;for(let e=0;e<this._lastSrcs.length;e++)if(this._lastSrcs[e]!==t[e]){s=!0,this._debugger&&(console.log("轮询遍历 script的src数组，分别对比位置及判断是否一致"),console.log("保存的script src集合:",this._lastSrcs),console.log("新的script src集合:",t),console.log(`index ${e}`,this._lastSrcs[e],"vs",t[e]));break}return this._lastSrcs=t,this._isWatchHtmlLength&&(0===this._htmlLangth&&(this._htmlLangth=e.length),this._htmlLangth!==e.length&&(s=!0,this._debugger&&(console.log("判断当前html字符串长度不一致说明有更新"),console.log("保存的html节点长度:",this._htmlLangth),console.log("新的html节点长度:",e.length))),this._htmlLangth=e.length),s}))}startTest(){clearTimeout(this._setTimeNum),this._setTimeNum=setTimeout((()=>s(this,void 0,void 0,(function*(){(yield this.needUpdate())?(console.log("The current site has been updated:","当前网站已更新"),"function"==typeof this._response?this._response()&&location.reload():confirm("确定更新吗?")?(clearTimeout(this._setTimeNum),location.reload()):clearTimeout(this._setTimeNum)):this.startTest()}))),this._times)}};return e})()));